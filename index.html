<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Ù…ÙˆÙ„Ù‘Ø¯ JSON Ù„Ù„ØºØ´</title>
<style>
body {background-color:#0f1113;color:#e6eef3;font-family:"Cairo",sans-serif;text-align:center;direction:rtl;padding:20px;}
h1{color:#00eaff;margin-bottom:8px;}
.box{background:#0b0d0f;border:1px solid #222;padding:12px;border-radius:10px;margin:12px auto;max-width:900px;text-align:right;}
input,button{margin:6px 6px 6px 0;padding:8px;border-radius:8px;border:1px solid #222;outline:none;font-size:15px;background:#111315;color:#e6eef3;}
input::placeholder{color:#888;}
button{background-color:#00eaff;color:#001216;cursor:pointer;border:none;}
button:disabled{opacity:0.5;cursor:default;}
.mods{margin-top:10px;display:flex;flex-direction:column;gap:10px;align-items:stretch;}
.offset-block{background:#0b0d0f;border:1px solid #222;padding:10px;border-radius:8px;margin-top:8px;text-align:right;}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
pre{background-color:#071015;padding:12px;border-radius:8px;text-align:left;direction:ltr;white-space:pre-wrap;word-break:break-word;margin-top:14px;max-height:320px;overflow:auto;border:1px solid #162022;}
.small{font-size:13px;color:#89a;}
</style>
</head>
<body>
<h1>ğŸ”§ Ù…ÙˆÙ„Ù‘Ø¯ JSON Ù„Ù„ØºØ´</h1>

<div class="box">
<div>
<label>Ø§Ø³Ù… Ø§Ù„Ù„Ø¹Ø¨Ø©:</label><br>
<input id="gameName" type="text" placeholder="Ù…Ø«Ø§Ù„: Black Ops III" />
</div>

<div style="margin-top:8px;">
<label>Ø§Ù„Ø¥ØµØ¯Ø§Ø± (version):</label><br>
<input id="version" type="text" placeholder="Ù…Ø«Ø§Ù„: 01.33" />
</div>

<div style="margin-top:8px;">
<label>Ø±Ù…Ø² CUSA (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label><br>
<input id="cusa" type="text" placeholder="Ù…Ø«Ø§Ù„: CUSA00419" />
</div>

<p class="small" style="margin-top:10px;">ğŸ“¦ Ù…Ù„Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (Ø«Ø§Ø¨Øª): <b>eboot.bin</b></p>

<div style="margin-top:6px;">
<button id="addModBtn">â• Ø¥Ù†Ø´Ø§Ø¡ ØºØ´ Ø¬Ø¯ÙŠØ¯</button>
<button id="generateBtn">ğŸ“„ ØªÙˆÙ„ÙŠØ¯ JSON</button>
<button id="downloadBtn" disabled>â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ index.json</button>
</div>

<div class="mods" id="modsContainer"></div>
<pre id="output">{ }</pre>
</div>

<script>
const mods = [];

function hexTrim(s){if(!s) return ''; s=String(s).trim(); if(s.startsWith('0x')||s.startsWith('0X')) s=s.slice(2); return s.replace(/[^0-9A-Fa-f]/g,'').toUpperCase();}
function toHex(n){return n.toString(16).toUpperCase();}

function renderMods(){
  const root=document.getElementById('modsContainer');
  root.innerHTML='';
  mods.forEach((mod,i)=>{
    const box=document.createElement('div'); box.className='box';
    box.innerHTML=`
      <div class="row" style="justify-content:space-between;">
        <input type="text" placeholder="ğŸ§© Ø§Ø³Ù… Ø§Ù„ØºØ´" value="${mod.name||''}" oninput="mods[${i}].name=this.value">
        <div>
          <button onclick="addOffset(${i})">â• Ø¥Ø¶Ø§ÙØ© Offset</button>
          <button onclick="removeMod(${i})" style="background:#ff7b7b;">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ØºØ´</button>
        </div>
      </div>
      <div id="offsets-${i}"></div>
    `;
    root.appendChild(box);
    mod.memory.forEach((mem,j)=>{
      const el=document.createElement('div');
      el.className='offset-block';
      el.innerHTML=`
        <div class="small">Offset: ${mem.offset}</div>
        <div class="small">ON: ${mem.on}</div>
        <div class="small">OFF: ${mem.off}</div>
        <button onclick="removeOffset(${i},${j})" style="background:#ff7b7b;">Ø­Ø°Ù</button>
      `;
      box.querySelector(`#offsets-${i}`).appendChild(el);
    });
  });
}

function addMod(){
  mods.push({name:'',type:'checkbox',memory:[]});
  const index = mods.length-1;
  renderMods();
  setTimeout(()=>addOffset(index), 0); // Ù†ÙØªØ­ offset Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„ØºØ´ Ø§Ù„Ø¬Ø¯ÙŠØ¯
}

function removeMod(i){if(confirm('Ø­Ø°Ù Ø§Ù„ØºØ´ØŸ')){mods.splice(i,1);renderMods();}}

function addOffset(modIndex=-1){
  if(modIndex<0) modIndex=mods.length-1;
  if(modIndex<0) return alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØºØ´ Ù„Ø¥Ù†Ø´Ø§Ø¡ offset ÙÙŠÙ‡');

  const container=document.querySelector(`#offsets-${modIndex}`);
  if(!container) return;

  const box=document.createElement('div'); box.className='offset-block';
  box.innerHTML=`
    <input placeholder="Offset (Ù…Ø«Ù„ 9A2F1F)" class="offset">
    <input placeholder="Ù‚ÙŠÙ…Ø© ON" class="on">
    <input placeholder="Ù‚ÙŠÙ…Ø© OFF" class="off"><br>
    <button class="save">ğŸ’¾ Ø­ÙØ¸</button>
    <button class="cont">â¡ï¸ Ø§Ø³ØªÙ…Ø±Ø§Ø±</button>
    <button class="newMod" style="background:#007bff;">âœ¨ ØµÙ†Ø¹ ØºØ´ Ø¬Ø¯ÙŠØ¯</button>
    <button class="cancel" style="background:#ff7b7b;">Ø¥Ù„ØºØ§Ø¡</button>
  `;
  container.appendChild(box);

  const save=box.querySelector('.save');
  const cont=box.querySelector('.cont');
  const cancel=box.querySelector('.cancel');
  const newMod=box.querySelector('.newMod');

  function saveOffset(next=false, createNew=false){
    const raw=hexTrim(box.querySelector('.offset').value);
    if(!raw) return alert('Ø£Ø¯Ø®Ù„ offset');
    const addrNum=parseInt(raw,16);
    if(Number.isNaN(addrNum)) return alert('Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ØºÙŠØ± ØµØ­ÙŠØ­');
    const calc=addrNum-0x400000;
    const offHex=(calc<0?'-':'')+toHex(Math.abs(calc));
    const onVal=box.querySelector('.on').value.trim();
    const offVal=box.querySelector('.off').value.trim();
    mods[modIndex].memory.push({offset:offHex,on:onVal,off:offVal});
    renderMods();
    if(next) addOffset(modIndex);
    if(createNew){ setTimeout(()=>addMod(),50); }
  }

  save.onclick=()=>saveOffset(false,false);
  cont.onclick=()=>saveOffset(true,false);
  newMod.onclick=()=>saveOffset(false,true);
  cancel.onclick=()=>box.remove();
}

function removeOffset(m,i){mods[m].memory.splice(i,1);renderMods();}

function generateJSON(){
  const data={
    name:document.getElementById('gameName').value.trim(),
    id:document.getElementById('cusa').value.trim(),
    version:document.getElementById('version').value.trim(),
    process:"eboot.bin",
    mods:mods,
    credits:["Ø³Ø§Ù„Ù… Ø§Ù„Ø­Ø§Ø±Ø«ÙŠ"]
  };
  const json=JSON.stringify(data,null,2);
  document.getElementById('output').textContent=json;

  const blob=new Blob([json],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const dl=document.getElementById('downloadBtn');
  dl.disabled=false;
  dl.onclick=()=>{
    const a=document.createElement('a');
    a.href=url;
    a.download='index.json';
    document.body.appendChild(a);
    a.click();
    a.remove();
  };
}

document.getElementById('addModBtn').onclick=addMod;
document.getElementById('generateBtn').onclick=generateJSON;

addMod(); // Ù†Ø¨Ø¯Ø£ Ø¨ØºØ´ ÙˆØ§Ø­Ø¯ Ø¬Ø§Ù‡Ø²
</script>
</body>
</html>